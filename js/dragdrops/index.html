<!DOCTYPE HTML>
<html>
<head>
<style>
	#div1,#div2 {
		width:90%;
		height:200px;
		padding:10px;
		border:1px solid ;
	}

	.component{
		width: 100px;
		height: 100px;
		border:1px solid #aaaaaa;
		float: left;
		margin: 5px;
	}

	.hy{
		border:7px solid yellow;
	}
	
	.container{
		width: 200px;
	}

	.separator{		
		height: 10px;
		border:1px solid #aaaaaa;
		float: left;
	}

</style>
  <link rel="stylesheet" href="http://code.jquery.com/ui/1.11.1/themes/smoothness/jquery-ui.css">
  <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
  <script src="http://code.jquery.com/ui/1.11.1/jquery-ui.js"></script>
  <script src="../..//dependency/injectJS/injectJS.js"></script>
</head>
<body>
	<div>
		<div id="div1" class="drop"></div>
		<div id="div2" class="drop"></div>
	</div>
<hr/>
	<div class="container">
		<ul>
			<li class="drag" style="background-color: yellow;">Comp1</li>
			<li class="drag" style="background-color: red;">Comp2</li>
			<li class="drag" style="background-color: blue;">Comp3</li>
			<li class="drag" style="background-color: green;">Comp4</li>
			<li class="drag" style="background-color: orange;">Comp5</li>
		</ul>
	</div>
</body>
<script>

$(function () {

	var separator = document.createElement("div");
	separator.className = 'separator';

	var x = 0, y = 0;
	var lastComponent;

	var addClass = function (doc, _class) {
		if(doc.className.indexOf(_class) == -1 )
			doc.className = doc.className + ' ' +_class;
	}

	var removeClass = function (doc, _class) {
		doc.className = doc.className.replace(_class, '');
	}	

 	var drags = document.querySelectorAll('.drag');

    [].forEach.call(drags, function(d) {
        d.addEventListener('dragstart', handleDragStart, false);
        d.addEventListener('dragenter', handleDragEnter, false);
        d.addEventListener('dragover', handleDragOver, false);
        d.addEventListener('dragleave', handleDragLeave, false);
        d.addEventListener('dragend', handleDragEnd, false);
        d.setAttribute('draggable', 'true');
    });

    var drops = document.querySelectorAll('.drop');

    [].forEach.call(drops, function(d) {    	
        d.addEventListener('drop', drop, false);
        d.addEventListener('dragover', handleDragOver, false);
    });

	function handleDragOver(ev) {			
	    ev.preventDefault();
	    var element = ev.target;
	    var parent = element.parentNode;
	    var left = ev.x < x
	    var rigth = ev.x > x;
	    var diff = lastComponent != element;
	    var parentLastComponent = (parent == lastComponent)	    
	    var monitor = '';

	    if(left){
	    	//console.debug('left');
	    	monitor += '\n direction : left';
	    }else if(rigth){
	    	//console.debug('rigth');
	    	monitor += '\n direction : rigth';
	    }

	    if(parent){
	    	monitor += '\n parent : '+parent.id;
	    	monitor += '\n\t parent is lastComponent : '+parentLastComponent;	    	
	    }

	    if(diff && left){
	    	//console.debug('prev', lastComponent, element);
	    	monitor += '\n insert : prev';
	    	monitor += '\n\t lastComponent : '+(lastComponent ? lastComponent.id : '?');
	    	monitor += '\n\t element : '+(element ? element.id : '?');
	    	if(!parentLastComponent){
	    		monitor += '\n\t target : '+(lastComponent ? lastComponent.id : '?');
	    	}
	    }

	    if(diff && rigth){
	    	//console.debug('next', lastComponent, element);
	    	monitor += '\n insert : next';
	    	monitor += '\n\t lastComponent : '+(lastComponent ? lastComponent.id : '?');
	    	monitor += '\n\t element : '+(element ? element.id : '?');
	    	if(!parentLastComponent){
	    		monitor += '\n\t target : '+(lastComponent ? lastComponent.id : '?');
	    	}
	    }

	    x = ev.x;
	    monitor += '\n -----------------------';

	    element.appendChild(separator);
	    lastComponent = element;
	    if(diff){
	    	//console.debug('diff');
	    	console.debug(monitor);
	    }    
	    
	}

	function handleDragEnd (ev) {		
	}

	function handleDragLeave (ev) {		
	}	

	function handleDragEnter (ev) {
		
	}

	function handleDragStart(ev) {
	    ev.dataTransfer.setData("text/html", ev.target.id);
	    ev.dataTransfer.setData("color", ev.target.getAttribute('style'));
	}

	function drop(ev) {		
	    ev.preventDefault();
	    var data = ev.dataTransfer.getData("text/html");
	    var color = ev.dataTransfer.getData("color");
	    var div;

	    if(data){
	    	div = document.getElementById(data);
	    	div.style = color;	    	
	    }else{
	    	div = document.createElement("div");
		    div.className = 'component';
		    div.id = 'ID'+Math.round(Math.random()*10000);
		    div.innerText = div.id;
		    div.setAttribute('draggable', 'true');
		    div.setAttribute('style', color);
		    div.addEventListener('dragstart', handleDragStart, false);
	    }
	    ev.target.appendChild(div);
	}
});


</script>
</html>